---
name: review
description: 複数の専門エージェントによるコードレビューを実行
priority: medium
suitable_for:
  scale: [small, medium, large]
  type: [review, analysis]
  understanding: "≥ 50%"
  urgency: [low, medium]
aliases: [code-review, cr]
timeout: 90
allowed-tools: Bash(git diff:*), Bash(git status:*), Bash(git log:*), Bash(git show:*), Read, Glob, Grep, LS, Task
context:
  files_changed: "dynamic"
  lines_changed: "dynamic"
  new_features: "detected"
  breaking_changes: "detected"
---

# /review - 高度なコードレビューオーケストレーター

## 目的

動的コンテキスト分析、階層的タスク分解、信頼度ベースのフィルタリングを備えた複数の専門レビューエージェントを調整します。

## 動的コンテキスト分析

### Gitステータス

Gitステータスを確認:

```bash
git status --porcelain
```

### 変更されたファイル

変更されたファイルをリスト:

```bash
git diff --name-only HEAD
```

### 最近のコミット

最近のコミットを表示:

```bash
git log --oneline -10
```

### 変更統計

変更統計を表示:

```bash
git diff --stat HEAD
```

## 階層的レビュープロセス

### フェーズ1: コンテキスト発見

Taskエージェントを使用して：

1. リポジトリ構造と技術スタックを分析
2. レビュースコープ（変更されたファイル、ディレクトリ）を特定
3. コードパターンと既存の品質基準を検出
4. 適用可能なレビューカテゴリを決定

### フェーズ2: 並列専門レビュー

複数のレビューエージェントを同時に起動：

- 各エージェントが特定の側面に焦点を当てる
- 効率的な独立実行
- 信頼度スコア付きの生の結果を収集

### フェーズ3: フィルタリングと統合

多層フィルタリングを適用：

1. **信頼度フィルタ**: 0.7以上の信頼度の問題のみ
2. **偽陽性フィルタ**: 除外ルールを適用
3. **重複排除**: 類似の結果をマージ
4. **優先順位付け**: 影響と重要度でソート

## レビューエージェントとその焦点

### コアアーキテクチャレビュアー

- `review-orchestrator`: すべてのレビュー活動を調整
- `structure-reviewer`: コード組織、DRY違反、結合度
- `root-cause-reviewer`: 深い問題分析、アーキテクチャ負債

### 品質保証レビュアー

- `readability-reviewer`: コードの明確性、命名、複雑性
- `type-safety-reviewer`: TypeScriptカバレッジ、any使用、型アサーション
- `testability-reviewer`: テスト設計、モック、カバレッジギャップ

### 専門ドメインレビュアー

- `security-reviewer`: 脆弱性、認証問題、データ露出
- `accessibility-reviewer`: WCAG準拠、キーボードナビゲーション、ARIA
- `performance-reviewer`: ボトルネック、バンドルサイズ、レンダリング問題
- `design-pattern-reviewer`: パターン一貫性、Reactベストプラクティス
- `progressive-enhancer`: CSSファーストソリューション、グレースフルデグラデーション
- `document-reviewer`: README品質、APIドキュメント、インラインコメント

## 除外ルール

### 自動除外（偽陽性防止）

1. **スタイル問題**: フォーマット、インデント（リンターが処理）
2. **軽微な命名**: 重大な誤解を招かない限り
3. **テストファイル**: 要求されない限り本番コードに焦点
4. **生成コード**: ビルド出力、ベンダーファイル
5. **ドキュメント**: ドキュメントを特別にレビューしない限り
6. **理論的問題**: 具体的な悪用パスなし
7. **パフォーマンスマイクロ最適化**: 測定可能な影響がない限り
8. **機能不足**: 実際のバグ/問題 vs

### コンテキスト認識除外

- フレームワーク固有パターン（React/Angular/Vueイディオム）
- プロジェクト規約（既存コードから検出）
- 言語固有の安全性（メモリセーフ言語）
- 環境仮定（ブラウザ vs Node.js）

## 信頼度スコアリング付き出力フォーマット

```markdown
## レビューサマリー
- レビューされたファイル: [カウントとリスト]
- 総問題数: [重要度別カウント]
- レビューカバレッジ: [パーセンテージ]
- 信頼度レベル: [平均信頼度]

## 重要な問題 🚨 (信頼度 > 0.9)
### 問題 #1: [タイトル]
- **ファイル**: path/to/file.ts:42
- **カテゴリ**: security|performance|accessibility|など
- **信頼度**: 0.95
- **説明**: [詳細な説明]
- **影響**: [ユーザー/システムへの影響]
- **推奨事項**: [コード例を含む具体的な修正]

## 高優先度 ⚠️ (信頼度 > 0.8)
[同様のフォーマット...]

## 中優先度 💡 (信頼度 > 0.7)
[同様のフォーマット...]

## 改善機会
[検討のための低信頼度の提案]

## メトリクス
- コード品質スコア: [A-F評価]
- 技術的負債見積もり: [時間]
- テストカバレッジギャップ: [パーセンテージ]
- セキュリティ状態: [評価]

## 推奨アクション
1. **即座**: [重要な修正]
2. **次のスプリント**: [高優先度項目]
3. **バックログ**: [あれば良い改善]
```

## レビュー戦略

### クイックレビュー（2-3分）

焦点領域：

- セキュリティ脆弱性
- 重要なバグ
- 破壊的変更
- アクセシビリティ違反

コマンド: `/review --quick`

### 標準レビュー（5-7分）

クイック + を含む：

- パフォーマンス問題
- 型安全性問題
- テストカバレッジギャップ
- コード組織

コマンド: `/review` (デフォルト)

### ディープレビュー（10分以上）

包括的分析：

- すべての標準チェック
- 根本原因分析
- 技術的負債評価
- リファクタリング機会
- アーキテクチャ評価

コマンド: `/review --deep`

### フォーカスレビュー

特定領域をターゲット：

- `/review --security` - セキュリティフォーカス
- `/review --performance` - パフォーマンスフォーカス
- `/review --accessibility` - A11yフォーカス
- `/review --architecture` - デザインパターン

## TodoWrite統合

自動タスク作成：

```markdown
# コードレビュー: [ターゲット]
1. ⏳ コンテキスト発見とスコープ分析
2. ⏳ 専門レビューエージェントを実行（並列）
3. ⏳ 結果をフィルタリングと検証（信頼度 > 0.7）
4. ⏳ 結果の統合と優先順位付け
5. ⏳ 実行可能な推奨事項の生成
```

## カスタムレビュー指示

プロジェクト固有ルールのサポート：

- `.claude/review-rules.md` - プロジェクト規約
- `.claude/exclusions.md` - カスタム除外
- `.claude/review-focus.md` - 優先領域

## 高度な機能

### インクリメンタルレビュー

ベースラインと比較：

```bash
git diff origin/main...HEAD --name-only
```

### パターン検出

繰り返し問題を特定：

- ファイル間の類似問題
- システム的なアーキテクチャ問題
- 一般的なアンチパターン

### 学習モード

追跡と改善：

- 偽陽性パターン
- プロジェクト固有のイディオム
- チームの好み

## 使用例

### 基本レビュー

```bash
/review
# 標準深度ですべての変更ファイルをレビュー
```

### ターゲットレビュー

```bash
/review "認証モジュール"
# 認証関連コードに焦点
```

### セキュリティ監査

```bash
/review --security --deep
# 包括的なセキュリティ分析
```

### PR前レビュー

```bash
/review --compare main
# mainブランチに対する変更をレビュー
```

### コンポーネントレビュー

```bash
/review "src/components" --accessibility
# componentsディレクトリのA11yレビュー
```

## ベストプラクティス

1. **早期レビュー**: 問題が複雑化する前にキャッチ
2. **インクリメンタルレビュー**: 小さく頻繁なレビュー > 大きく稀なレビュー
3. **高信頼度に基づく行動**: 0.8以上の信頼度問題に焦点
4. **パターン追跡**: 繰り返し問題を特定
5. **ルールのカスタマイズ**: プロジェクト固有の除外を追加
6. **フィードバックの反復**: 信頼度閾値を調整

## 統合ポイント

### Pre-commitフック

```bash
claude review --quick || exit 1
```

### CI/CDパイプライン

```yaml
- name: Code Review
  run: claude review --security --performance
```

### PRコメント

GitHub/GitLabコメント用にフォーマットされた結果

## レビュー後の次のステップ

- **重要な問題** → 本番問題には `/hotfix`
- **バグ** → 開発修正には `/fix`
- **リファクタリング** → 改善には `/think` → `/code`
- **パフォーマンス** → メトリクスでターゲット最適化
- **テスト** → カバレッジ目標で `/test`
- **ドキュメント** → 結果に基づいて更新
