---
name: research
description: プロジェクト理解と技術調査を行う（実装なし）
priority: medium
suitable_for:
  scale: [small, medium, large]
  type: [exploration, analysis, learning]
  understanding: "≥ 30%"
  urgency: [low, medium]
aliases: []
timeout: 90
allowed-tools: Bash(find:*), Bash(tree:*), Bash(ls:*), Bash(cat package.json:*), Read, Glob, Grep, LS, Task
context:
  project_structure: "dynamic"
  tech_stack: "discovered"
  dependencies: "analyzed"
  patterns: "identified"
---

# /research - 高度なプロジェクト調査と技術研究

## 目的

動的発見、並列検索実行、信頼度ベースの結果により、実装のコミットメントなしにコードベースを調査します。

## 動的プロジェクト発見

### プロジェクト構造
以下のコマンドで探索：
```bash
tree -L 2 -I 'node_modules|dist|build|coverage|.git' | head -20
# または
ls -la
```

### 技術スタック
package.jsonでフレームワークをチェック：
```bash
cat package.json | grep -E '"(react|vue|angular|next|nuxt|svelte|express|fastify|nest)"'
```

### 言語分布
ソースファイルタイプを検索：
```bash
find . -type f \( -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" -o -name "*.py" -o -name "*.go" \) -not -path "*/node_modules/*" | sed 's/.*\.//' | sort | uniq -c | sort -rn
```

### 依存関係分析
主要な依存関係をリスト：
```bash
cat package.json | jq -r '.dependencies | keys[]' | head -10
```

### 設定ファイル
設定ファイルを検索：
```bash
ls -la *.config.* *.json *.yml *.yaml | grep -v node_modules
```

## 階層的調査プロセス

### フェーズ1: スコープ発見
プロジェクトを分析して理解：
1. **アーキテクチャ**: プロジェクト構造とパターンを特定
2. **技術**: フレームワーク、ライブラリ、ツールを検出
3. **規約**: コーディング標準と実践を認識
4. **エントリーポイント**: メインファイル、エクスポート、APIを見つける

### フェーズ2: 並列調査
効率のために検索を同時実行：
- **パターン検索**: 複数のgrep操作を並列で
- **ファイル発見**: 同時グロブパターン
- **依存関係追跡**: 並列インポート分析
- **ドキュメントスキャン**: 並行README/docs読み込み

### フェーズ3: 統合とスコアリング
信頼度レベルで結果を統合：
1. **信頼度スコアリング**: 各結果を評価（0.0-1.0）
2. **パターン認識**: 繰り返しテーマを特定
3. **関係マッピング**: 関連コンポーネントを接続
4. **優先度評価**: 重要度でランク付け

## 調査戦略

### クイックスキャン（1-2分）
表面レベルの理解：
```bash
find . -type f -name "*.md" -not -path "*/node_modules/*" | head -5 | xargs head -20
```

コマンド: `/research --quick`

### 標準調査（3-5分）
深さと幅のバランス：
- コアアーキテクチャの理解
- 主要パターンの特定
- 主要依存関係の分析

コマンド: `/research` (デフォルト)

### ディープダイブ（5-10分）
包括的な調査：
- 完全なアーキテクチャマッピング
- すべてのパターンと関係
- 完全な依存関係グラフ
- 履歴コンテキスト（git履歴）

コマンド: `/research --deep`

### フォーカス調査
特定領域をターゲット：
- `/research --auth` - 認証システム
- `/research --api` - API構造
- `/research --state` - 状態管理
- `/research --data` - データフロー

## 効率的な検索パターン

### 並列実行例
```typescript
// 逐次ではなく、これらを同時に実行
const searches = [
  Grep({ pattern: "class.*Controller", glob: "**/*.ts" }),
  Grep({ pattern: "export.*function", glob: "**/*.js" }),
  Glob({ pattern: "**/*.test.*" }),
  Glob({ pattern: "**/api/**" })
];
```

### スマートパターン選択
初期発見に基づく：
- **Reactプロジェクト**: フック、コンポーネント、コンテキストを検索
- **APIプロジェクト**: ルート、コントローラー、ミドルウェアを検索
- **ライブラリプロジェクト**: エクスポート、型、テストを検索

## 信頼度ベースの結果

### 結果の分類
```markdown
## 高信頼度の結果 (> 0.8)
### 認証システム
- **場所**: src/auth/*
- **タイプ**: JWTベース
- **信頼度**: 0.95
- **証拠**: 複数のJWTインポート、トークン検証ミドルウェア
- **依存関係**: jsonwebtoken, bcrypt
- **エントリーポイント**: auth.controller.ts, auth.middleware.ts

## 中信頼度の結果 (0.5 - 0.8)
### 状態管理
- **パターン**: Redux風パターンを検出
- **信頼度**: 0.7
- **証拠**: アクション、リデューサーフォルダが見つかった
- **不確実性**: 実際のライブラリが不明（Redux/MobX/Zustand？）

## 低信頼度の結果 (< 0.5)
### 可能なパターン
- マイクロサービスを使用している可能性（0.4）- 複数のサービスフォルダ
- WebSocketサポートがある可能性（0.3）- 依存関係にsocket.io
```

## TodoWrite統合

自動タスク追跡：
```markdown
# 調査: [トピック]
1. ⏳ プロジェクト構造を発見（30秒）
2. ⏳ 技術スタックを特定（30秒）
3. ⏳ 並列検索を実行（2分）
4. ⏳ 結果を分析（1分）
5. ⏳ 信頼度レベルをスコア（30秒）
6. ⏳ レポートを統合（1分）
```

## Taskエージェントの使用

### Taskエージェントを使用する場合
`general-purpose`エージェントを使用：
- **複雑な調査**: 10以上の関連検索
- **探索的分析**: 未知の構造
- **関係マッピング**: 接続の理解
- **履歴調査**: Git履歴分析

### Taskエージェント例
```typescript
Task({
  subagent_type: "general-purpose",
  description: "認証フロー分析",
  prompt: `完全な認証システムを調査：
    1. すべての認証関連ファイルを見つける
    2. 認証フローをマッピング
    3. セキュリティパターンを特定
    4. トークンライフサイクルを追跡
    5. APIエンドポイントを文書化
    包括的な認証アーキテクチャレポートを返す`
})
```

## 高度な機能

### 相互参照分析
異なる領域間で結果を接続：
```bash
grep -l "AuthController" **/*.ts | xargs grep -l "UserService"
```

### インポート依存関係グラフ
モジュール依存関係を追跡：
```bash
grep -h "^import.*from" **/*.ts | sed "s/.*from ['\"]\.\/\(.*\)['\"].*/\1/" | sort | uniq -c | sort -rn | head -10
```

### パターン頻度分析
一般的なパターンを特定：
```bash
grep -oh "use[A-Z][a-zA-Z]*" **/*.tsx | sort | uniq -c | sort -rn | head -10
```

### 履歴コンテキスト
進化を理解：
```bash
git log --oneline --since="3 months ago" --pretty=format:"%h %s" | head -10
```

## 出力フォーマット

```markdown
## 調査サマリー
- **スコープ**: [調査対象]
- **所要時間**: [かかった時間]
- **信頼度**: [全体的な信頼度スコア]
- **カバレッジ**: [分析されたコードベースの％]

## 主要な発見

### アーキテクチャ（信頼度: 0.9）
- **パターン**: [MVC/マイクロサービス/モノリス]
- **構造**: [説明]
- **エントリーポイント**: [メインファイル]

### 技術スタック（信頼度: 0.95）
- **フレームワーク**: [React/Vue/Express/など]
- **言語**: [TypeScript/JavaScript]
- **主要ライブラリ**: [リスト]

### コードパターン（信頼度: 0.85）
- **デザインパターン**: [Observer/Factory/など]
- **規約**: [命名/構造]
- **ベストプラクティス**: [特定されたパターン]

## 信頼度別の結果

### 高信頼度 (>0.8)
1. [証拠付きの結果]
2. [証拠付きの結果]

### 中信頼度 (0.5-0.8)
1. [不確実性を記載した結果]
2. [仮定を含む結果]

### 低信頼度 (<0.5)
1. [可能なパターン]
2. [検証が必要]

## 発見された関係
- [コンポーネントA] → [コンポーネントB]: [関係タイプ]
- [サービスX] ← [モジュールY]: [依存関係]

## 推奨事項
1. **即座の焦点**: [最も重要な領域]
2. **さらなる調査**: [より深い調査が必要な領域]
3. **実装アプローチ**: [/codeに移行する場合]

## 参考文献
- 主要ファイル: [パス付きリスト]
- ドキュメント: [リンク/パス]
- 外部リソース: [見つかった場合]
```

## 永続的なドキュメント

重要な結果について、以下に保存：
```bash
.claude/workspace/research/YYYY-MM-DD-[topic].md
```

含める内容：
- アーキテクチャ図（ASCII）
- 依存関係グラフ
- 主要コードスニペット
- 将来の参照ノート

## 使用例

### クイック調査
```bash
/research --quick "API構造"
# API組織の高速概要
```

### 標準調査
```bash
/research "認証実装"
# 認証システムのバランスの取れた調査
```

### ディープ調査
```bash
/research --deep "完全なデータフロー"
# UIからデータベースまでの包括的分析
```

### フォーカス調査
```bash
/research --state "Redux実装"
# ターゲットを絞った状態管理調査
```

## ベストプラクティス

1. **広く始める**: 深く掘る前に概要を取得
2. **並列検索**: 複数の検索を同時に実行
3. **信頼度をスコア**: 常に結果の信頼性を評価
4. **パターンを文書化**: 繰り返しテーマに注意
5. **関係をマップ**: コンポーネントを接続
6. **重要な結果を保存**: 将来の参照のために永続化

## パフォーマンスのヒント

### 検索の最適化
- 特定のグロブを使用: `**/*`ではなく`**/*.controller.ts`
- 可能な場合は深さを制限: `-maxdepth 3`
- 無関係を除外: `-not -path "*/test/*"`

### 効率的なパターン
- 関連検索をバッチ処理
- 10以上の操作にはTaskエージェントを使用
- 一般的なクエリ結果をキャッシュ

## 次のステップ

- **問題が見つかった** → ターゲットソリューションには `/fix`
- **計画が必要** → アーキテクチャ決定には `/think`
- **構築の準備ができた** → 実装には `/code`
- **ドキュメントが必要** → 包括的なドキュメントを作成
